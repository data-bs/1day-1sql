-- ðŸŽ® ë¬¸ì œ: â€œ7ì¼ ì—°ì† ë¡œê·¸ì¸ ìœ ì € ì°¾ê¸°â€
-- 
-- 1. ì„¤ëª…
-- 
-- ê²Œìž„ íšŒì‚¬ëŠ” **ì‹ ê·œ ìœ ì €ì˜ ìž”ì¡´ìœ¨(Retention)**ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤.
-- ë‹¤ìŒì€ ìœ ì €ë“¤ì˜ ë¡œê·¸ì¸ ê¸°ë¡ìž…ë‹ˆë‹¤. ì´ ì¤‘ì—ì„œ ì²˜ìŒ ë¡œê·¸ì¸í•œ ë‚ ë¡œë¶€í„° 7ì¼ê°„ ì—°ì†ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ìœ ì €ë§Œ ê³¨ë¼ì£¼ì„¸ìš”.
-- 	â€¢	ë‹¨, ë¡œê·¸ì¸ ë‚ ì§œëŠ” ì¤‘ë³µì´ ìžˆì„ ìˆ˜ ìžˆìœ¼ë©°, ì¤‘ë³µì€ ì œê±°í•˜ê³  ì—°ì† ì—¬ë¶€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.
-- 	â€¢	ë¡œê·¸ì¸ì€ ìœ ì € ê¸°ì¤€ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
-- 	â€¢	7ì¼ ì—°ì† ë¡œê·¸ì¸ì€ â€œì˜ˆ: 2025-05-01, 02, 03, 04, 05, 06, 07â€ì²˜ëŸ¼ ëŠê¹€ ì—†ì´ 7ì¼ì´ ì¡´ìž¬í•´ì•¼ í•©ë‹ˆë‹¤.
-- 
-- 2. í…Œì´ë¸” êµ¬ì¡°
CREATE TABLE user_logins (
    user_id INT,
    login_date DATE
);

-- 3. í…Œì´ë¸” INSERT
INSERT INTO user_logins (user_id, login_date) VALUES
-- ìœ ì € 1: ì—°ì† ë¡œê·¸ì¸ (ì •ë‹µ)
(1, '2025-05-01'), (1, '2025-05-02'), (1, '2025-05-03'),
(1, '2025-05-04'), (1, '2025-05-05'), (1, '2025-05-06'),
(1, '2025-05-07'),

-- ìœ ì € 2: í•˜ë£¨ ë¹ ì§ (ì˜¤ë‹µ)
(2, '2025-05-01'), (2, '2025-05-02'), (2, '2025-05-03'),
(2, '2025-05-04'), (2, '2025-05-06'), (2, '2025-05-07'),
(2, '2025-05-08'),

-- ìœ ì € 3: ì¤‘ë³µ ìžˆìŒ (ì •ë‹µ)
(3, '2025-05-01'), (3, '2025-05-01'), (3, '2025-05-02'),
(3, '2025-05-03'), (3, '2025-05-04'), (3, '2025-05-05'),
(3, '2025-05-06'), (3, '2025-05-07'),

-- ìœ ì € 4: ë„ˆë¬´ ì§§ìŒ (ì˜¤ë‹µ)
(4, '2025-05-01'), (4, '2025-05-02'), (4, '2025-05-03');

-- 4. ì •ë‹µ
WITH distinct_logins AS (
    SELECT DISTINCT user_id, login_date
    FROM user_logins
),
ranked_logins AS (
    SELECT
        user_id,
        login_date,
        ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY login_date) AS rn
    FROM distinct_logins
),
grouped_logins AS (
    SELECT
        user_id,
        login_date,
        login_date - (rn * INTERVAL '1 day') AS grp
    FROM ranked_logins
),
grouped_counts AS (
    SELECT
        user_id,
        COUNT(*) AS streak_length
    FROM grouped_logins
    GROUP BY user_id, grp
)
SELECT DISTINCT user_id
FROM grouped_counts
WHERE streak_length >= 7
ORDER BY user_id;